---
title: "Plotting daily data with quality symbols -- the function ch_qa_hydrograph"
author: "CSHS hydRology Team"
date: "March 2021"
output: rmarkdown::word_document

vignette: >
  %\VignetteIndexEntry{data source differences}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}

---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(CSHShydRology)
library(tidyhydat)



source("C:/R-packages/CSHShydrology/R/ch_tidyhydat_ECDE.R")
source("C:/R-packages/CSHShydrology/R/ch_get_ECDE_metadata.R")
source("C:/R-packages/CSHShydrology/R/ch_read_ECDE_flows.R")
source("C:/R-packages/CSHShydrology/R/ch_tidyhydat_ECDE_meta.R")
source("C:/R-packages/CSHShydrology/R/ch_qa_hydrograph.R")

data(HYDAT_list)
```

One of the key opportunities for users of the R-package __CSHShydRology__ is that users can tap into the computer functions that are used by other professionals across Canada.  Many of the functions have been developed by practitioners and researchers and are shared so that the entire community can perform analysis and interpretation based on the current state of the art.  

The current version of __CSHShydRology__ can be obtained from GitHub at https://github.com/CSHS-CWRA/CSHShydRology. It is planned to release the package through CRAN (https://cran.r-project.org/) later this year.


## The function ch_qa_hydrograph


This article, which is written using Rmarkdown (cran.r-project.org/web/packages/rmarkdown/vignettes/rmarkdown.html), shows how to  plot daily streamflows obtained either from tidyhydat or ECDE showing the quality flags "SYM".  This function can duplicate the daily flow plot used in ECDE and some additional options.

1. the default ECDE plot
2. a ECDE plot with counts of symbols in legend.
3. a plot with a specific date range. You can choose to scale this range base on either the entire dataset (for comparing periods with the same y-axis), or have the y-axis  on the plot be based on the data in the selected range.


Note that all __CSHShydRology__ functions start with  "ch_"



This vignette demonstrates the options of the  function ch_qa_hydrograph. 

First, start by getting the data from an ECDE file in a working directory using ch_read_ECDE_flows. The function only needs a dataframe of daily flow data that is obtained by reading a daily flow data file from ECDE , or __tidyhydat__.  Here ch_read_ECDE_flows is used to get that dataframe.  


```{r, echo=TRUE}

#use setwd() to where the file is located.

e05CK004<- ch_read_ECDE_flows("05CK004_Daily_Flow_ts.csv")

str(e05CK004)



```

Now that we have the daily flow data in this form we can demonstrate the function ch_qa_hydrograph.  First, we want to get the plot in the same form as ECDE by not showing the counts of SYM codes (cts=FALSE).


```{r, echo=TRUE, fig.width=6, fig.height=5}

e_test <- ch_qa_hydrograph(e05CK004, cts=FALSE)



```

Figure 1.  The daily streamflow plot as would be generated in ECDE.  

The function returns a list that contains [1] a character string of "StationID  StationName", [2] the start_date if provided, [3] the end_date if provided, [4] the total number of data points, and [5] the SYM_count  [Default, A, B, C, D, E].

```{r, echo=TRUE, fig.width=6, fig.height=5}

str(e_test)



```


The default mode of the function ch_qa_hydrograph  is to the same  plot but the count of each SYM in the dataset is added to the the legend.


```{r, echo=TRUE,fig.width=6, fig.height=5}


m_test <- ch_qa_hydrograph(e05CK004)


```

Figure 2. The default plot from this function with counts of symbol codes in legend.


There are also options that allow for selected date rangesand for keeping the y-axis scaling constant based on the entire dataset or allwing it to be rescaled for the selected range.  In the following we provide start and end dates, and allow the y-axis to be scaled for this time period.

```{r, echo=TRUE,fig.width=6, fig.height=5}


st_date <- "1980-01-01"
end_date <- "1999-12-31"
m_test <- ch_qa_hydrograph(e05CK004, sdate=st_date, edate=end_date)

```


Figure 3. Plot with code counts and the y-axis scaled based on this time period.

We can also choose to make the plot maintain the y-axis scaling for the entire dataset we would be used to plot multiple time periods with the scaling.  A simple loop would let you do five or ten year periods.


```{r, echo=TRUE,fig.width=6, fig.height=5}


m_test <- ch_qa_hydrograph(e05CK004, sdate=st_date, edate=end_date, rescale=TRUE)

```

Figure 4. Plot with code counts for a selected time period with y-axis as for the entire dataset.

Now we can lok at the contents of m_test and see the details for this subset of the streamflow record.

```{r, echo=TRUE,fig.width=6, fig.height=5}


str(m_test)

```




_Other articles in this series are available on the CSHS GreyJay website: URL._

P.H.Whitfield 
